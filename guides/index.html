<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Guides</title>
<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- Markdown Parser -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
:root{
  --bg1:#071226; --bg2:#041022;
  --card:#0d1b2b; --accent:#ff6b2d;
  --muted:#9fb0c6;
}

body{
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:Inter,sans-serif;
  margin:0; padding:25px;
  color:white;
}

h1{
  text-align:center;
  font-size:40px;
  margin-bottom:15px;
  color:white;
}

/* SEARCH */
#search-container {
  max-width:850px;
  margin:0 auto 25px;
}
#search {
  width:100%; padding:12px; border-radius:10px;
  border:1px solid rgba(255,255,255,0.15);
  background:rgba(255,255,255,0.06);
  color:white;
  font-size:16px;
}

/* CATEGORY BAR */
.category-bar {
  max-width:850px;
  margin:0 auto 20px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.category-btn {
  background:rgba(255,255,255,0.06);
  padding:8px 14px;
  border-radius:10px;
  font-size:14px;
  cursor:pointer;
  border:1px solid transparent;
  transition:.2s;
}
.category-btn.active,
.category-btn:hover {
  background:var(--accent);
  color:white;
  border-color:var(--accent);
}

/* BLOG CARDS */
.blog-container {
  max-width:850px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  gap:22px;
}
.blog-card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.08);
  transition:.25s;
}
.blog-card:hover{
  transform:translateY(-5px);
}
.blog-title{
  font-size:22px;
  font-weight:700;
  color:var(--accent);
}
.blog-date{
  font-size:13px;
  color:var(--muted);
  margin-bottom:12px;
}
.blog-image{
  width:100%; height:auto;
  border-radius:12px;
  margin:10px 0;
}
.blog-preview{
  font-size:16px;
  color:#dfe7f0;
  line-height:1.55;
}

/* TAGS */
.tag-list{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.tag{
  padding:4px 8px;
  background:rgba(255,255,255,0.08);
  border-radius:6px;
  font-size:12px;
  color:var(--muted);
}
.tag:hover{
  background:var(--accent);
  color:white;
}

/* FEATURED POST */
.featured {
  max-width:850px;
  margin:0 auto 35px;
  background:linear-gradient(180deg,#11233a,#0a182a);
  padding:22px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.1);
  box-shadow:0 8px 30px rgba(0,0,0,0.45);
}
.featured h2{
  margin:0 0 12px;
  color:var(--accent);
}
.featured img{
  width:100%;
  border-radius:12px;
  margin:15px 0;
}

/* MOBILE FIXES */
@media (max-width:650px){
  body{ padding:15px; }
  h1{ font-size:32px; }
  .blog-card{ padding:18px; }
}
</style>
</head>

<body>

<h1>FluxTV Guides / Posts</h1>

<div id="search-container">
  <input id="search" type="text" placeholder="Search blog posts...">
</div>

<div class="category-bar" id="categoryBar"></div>
<div id="featured"></div>
<div id="blog" class="blog-container"></div>

<script>
let allPosts = [];
let activeCategory = "All";

/* Strip HTML safely for preview */
function stripHTML(html){
  let div = document.createElement("div");
  div.innerHTML = html;
  return div.textContent || div.innerText || "";
}

/* Load All Posts */
async function loadPosts(){
  const res = await fetch("/guides/posts.json");
  allPosts = await res.json();

  buildCategories();
  buildFeatured();
  renderPosts();
}

/* CATEGORY BAR */
function buildCategories(){
  const bar = document.getElementById("categoryBar");
  const categories = ["All", ...new Set(allPosts.map(p => p.category))];

  categories.forEach(cat => {
    const btn = document.createElement("div");
    btn.className = "category-btn" + (cat === "All" ? " active" : "");
    btn.textContent = cat;

    btn.onclick = () => {
      activeCategory = cat;
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderPosts();
    };

    bar.appendChild(btn);
  });

  /** FIX: force-run "All" button click */
  document.querySelector(".category-btn").click();
}

/* FEATURED POST — newest */
function buildFeatured(){
  const box = document.getElementById("featured");
  const sorted = [...allPosts].sort((a,b)=>new Date(b.date) - new Date(a.date));
  const p = sorted[0];

  let html = marked.parse(post.content || "");
if (!html || html.trim() === "") html = post.content || "";
const preview = stripHTML(html).substring(0,150) + "...";


  box.innerHTML = `
    <div class="featured">
      <h2>Featured Guide</h2>
      <h3 class="blog-title">${p.title}</h3>
      <div class="blog-date">${new Date(p.date).toLocaleDateString()}</div>
      ${p.image ? `<img src="${p.image}" alt="">` : ""}
      <p>${preview}</p>
      <a href="/guides/post.html?id=${p.id}" style="color:var(--accent);font-weight:700">
        Read Full Guide →
      </a>
    </div>
  `;
}

/* Render Blog List */
function renderPosts(){
  const blog = document.getElementById("blog");
  const search = document.getElementById("search").value.toLowerCase();
  blog.innerHTML = "";

  let filtered = allPosts
    .filter(p => activeCategory === "All" || p.category === activeCategory)
    .filter(p =>
      p.title.toLowerCase().includes(search) ||
      p.content.toLowerCase().includes(search) ||
      (p.tags || []).some(t => t.toLowerCase().includes(search))
    )
    .sort((a,b)=>new Date(b.date) - new Date(a.date));

  filtered.forEach(post => {
    const preview = stripHTML(marked.parse(post.content)).substring(0,150) + "...";

    const card = document.createElement("div");
    card.className = "blog-card";
    card.onclick = () => window.location.href = `/guides/post.html?id=${post.id}`;

    card.innerHTML = `
      <div class="blog-title">${post.title}</div>
      <div class="blog-date">${new Date(post.date).toLocaleDateString()}</div>
      ${post.image ? `<img src="${post.image}" class="blog-image">` : ""}
      <div class="blog-preview">${preview}</div>
      <div class="tag-list">
        ${(post.tags || []).map(t => `<div class="tag">${t}</div>`).join("")}
      </div>
    `;

    blog.appendChild(card);
  });
}

document.getElementById("search").addEventListener("input", renderPosts);

loadPosts();
</script>

</body>
</html>

