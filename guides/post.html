<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Guide Post</title>
<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- Markdown Parser -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
:root {
  --bg1:#071226;
  --bg2:#041022;
  --card:#0d1b2b;
  --accent:#ff6b2d;
  --muted:#9fb0c6;
}

body {
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  margin: 0;
  font-family: Inter, sans-serif;
  color: white;
  padding: 25px;
}

.back {
  display: inline-block;
  margin-bottom: 20px;
  color: var(--accent);
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
}

/* -------------------------------------------------
   Post Content Container
------------------------------------------------- */
.post-content {
  max-width: 850px;
  margin: 0 auto;
  background: var(--card);
  padding: 25px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 6px 25px rgba(0,0,0,0.45);
  font-size: 17px;
  line-height: 1.65;
}

/* -------------------------------------------------
   TITLES, DATES
------------------------------------------------- */
.post-title {
  font-size: 32px;
  font-weight: 700;
  color: var(--accent);
}

.post-date {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 18px;
}

/* -------------------------------------------------
   IMAGE RULES (MERGED & FIXED)
------------------------------------------------- */
.post-content img {
  max-width: 100%;
  width: 100%;
  height: auto;
  border-radius: 14px;
  display: block;
  margin: 25px auto;
  cursor: zoom-in;
  transition: box-shadow .25s, transform .25s;
  box-shadow: 0 8px 25px rgba(0,0,0,0.35);

  /* fade-in */
  opacity: 0;
  animation: fadeIn .7s ease forwards;
  animation-delay: .2s;
}

.post-content img:hover {
  transform: scale(1.01);
  box-shadow: 0 12px 30px rgba(0,0,0,0.55);
}

.post-content * {
  max-width: 100%;
  overflow-wrap: break-word;
}

/* -------------------------------------------------
   ZOOM MODAL
------------------------------------------------- */
#imgZoomModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: zoom-out;
}

#imgZoomModal img {
  max-width: 95%;
  max-height: 95%;
  border-radius: 12px;
  box-shadow: 0 0 35px rgba(0,0,0,0.55);
}

/* -------------------------------------------------
   SCROLL PROGRESS BAR
------------------------------------------------- */
#progressBar {
  position: fixed;
  top: 0;
  left: 0;
  height: 4px;
  background: #ff6b2d;
  width: 0%;
  z-index: 9999;
  box-shadow: 0 0 10px #ff6b2d;
}

/* -------------------------------------------------
   TOC
------------------------------------------------- */
#toc {
  max-width: 850px;
  margin: 0 auto 35px auto;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 20px;
  border-radius: 14px;
}

#toc h3 {
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 20px;
  font-weight: 700;
}

#toc ul {
  margin: 0;
  padding-left: 20px;
}

#toc li {
  margin: 6px 0;
}

#toc a {
  color: #ff6b2d;
  text-decoration: none;
}

#toc a:hover {
  text-decoration: underline;
}

/* -------------------------------------------------
   Fade-in Animation
------------------------------------------------- */
.fade-in {
  opacity: 0;
  transform: translateY(12px);
  animation: fadeIn .6s ease forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in.delay-1 { animation-delay: .1s; }
.fade-in.delay-2 { animation-delay: .2s; }
.fade-in.delay-3 { animation-delay: .3s; }
.fade-in.delay-4 { animation-delay: .4s; }

</style>
</head>

<body>

<div class="back" onclick="history.back()">‚Üê Back to Guides</div>

<div id="progressBar"></div>

<div id="toc" class="fade-in delay-1">
  <h3>Table of Contents</h3>
  <ul id="tocList"></ul>
</div>

<div class="post-content fade-in delay-2" id="postContent"></div>

<div id="imgZoomModal">
  <img id="zoomedImage" src="">
</div>

<script>
/* ------------------------------------------
   Load Post
------------------------------------------ */
async function loadPost() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const box = document.getElementById("postContent");

  try {
    const res = await fetch("/guides/posts.json");
    const posts = await res.json();
    const post = posts.find(p => String(p.id) === String(id));

    if (!post) {
      box.innerHTML = "Post not found.";
      return;
    }

    let formattedContent = marked.parse(post.content || "");
    if (!formattedContent.trim()) {
      formattedContent = "<p>No content available.</p>";
    }

    box.innerHTML = `
      <div class="post-title delay-1 fade-in">${post.title}</div>
      <div class="post-date delay-1 fade-in">${new Date(post.date).toLocaleDateString()}</div>
      ${post.image ? `<img src="${post.image}" class="delay-1 fade-in">` : ""}
      <div class="delay-2 fade-in">${formattedContent}</div>
    `;

    generateTOC();

  } catch(err) {
    box.innerHTML = "Error loading post.";
  }
}

loadPost();

/* ------------------------------------------
   Zoom Image
------------------------------------------ */
document.addEventListener("click", function(e) {
  if (e.target.matches(".post-content img")) {
    const modal = document.getElementById("imgZoomModal");
    const zoomImg = document.getElementById("zoomedImage");

    zoomImg.src = e.target.src;
    modal.style.display = "flex";
  }
});

document.getElementById("imgZoomModal").addEventListener("click", () => {
  document.getElementById("imgZoomModal").style.display = "none";
});

/* ------------------------------------------
   Scroll Progress Bar
------------------------------------------ */
window.addEventListener("scroll", () => {
  const scrollTop = window.scrollY;
  const docHeight = document.body.scrollHeight - window.innerHeight;
  const progress = (scrollTop / docHeight) * 100;
  document.getElementById("progressBar").style.width = progress + "%";
});

/* ------------------------------------------
   Generate TOC
------------------------------------------ */
function generateTOC() {
  const content = document.querySelector(".post-content");
  const tocList = document.getElementById("tocList");

  tocList.innerHTML = "";

  const headings = content.querySelectorAll("h1, h2, h3");

  headings.forEach((h, i) => {
    const id = "heading-" + i;
    h.id = id;

    const li = document.createElement("li");
    const a = document.createElement("a");

    a.textContent = h.textContent;
    a.href = "#" + id;

    li.appendChild(a);
    tocList.appendChild(li);
  });
}

/* ------------------------------------------
   Smooth Scroll for TOC
------------------------------------------ */
document.addEventListener("click", (e) => {
  if (e.target.matches("#toc a")) {
    e.preventDefault();
    document.querySelector(e.target.getAttribute("href"))
      .scrollIntoView({ behavior: "smooth" });
  }
});
</script>

</body>
</html>
